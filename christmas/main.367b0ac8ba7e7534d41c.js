(()=>{"use strict";var e={377:(e,t,a)=>{e.exports=a.p+"ca702ce66d387e612f6d.svg"},195:(e,t,a)=>{e.exports=a.p+"34d5c2d6ef9d1d77b576.svg"},183:(e,t,a)=>{e.exports=a.p+"e040db2edc06f3e605fe.svg"},769:(e,t,a)=>{e.exports=a.p+"fad9c2be56742c6f227a.json"}},t={};function a(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,a),n.exports}a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{const e=new class{constructor(){this.rootNode=document.createElement("header"),this.rootNode.className="header"}getTemplate(e,t,a,s,i){return this.rootNode.textContent="",e&&this.rootNode.insertAdjacentHTML("afterbegin",function(e,t){const a=e?"":"hidden";return`\n  <div class="wrapper header__wrapper">\n    <div class="inner-container inner-container_left">\n      <span class="icon volume"></span>\n      <span class="icon theme"></span>\n      <div class="search-container">\n        <input type="search" class="search button ${a}" placeholder="Поиск" autocomplete="off" autofocus  data-name="name">\n        <span class="search-icon ${a}" data-value="search">\n      </div>\n    </div>\n    <div class="inner-container inner-container_right">\n      <div class="navigation">\n        <a href="#/" class="link__text icon tree home-route"></a>\n        <a href="#/toys" class="link__text toys-route">Игрушки</a>\n        <a href="#/tree" class="link__text tree-route">Ёлка</a>\n      </div>\n      <div class="icon favorite">\n        <span class="favorite-number">${t||0}</span>\n      </div>\n    </div>\n  </div>\n  `}(t,i)),a&&(this.rootNode.onchange=e=>a(e)),s&&(this.rootNode.onclick=e=>s(e)),this.rootNode}},t=new class{constructor(){this.rootNode=document.createElement("footer"),this.rootNode.className="footer"}getTemplate(){return this.rootNode.textContent="",this.rootNode.insertAdjacentHTML("afterbegin",'\n  <div class="wrapper footer__wrapper">\n    <div class="info">\n      <p>©</p>\n      <p>2021</p>\n      <a class="link" href="https://github.com/OlgaTolpykina" target="_blank">Olga Tolpykina</a>\n    </div>\n    <a class="link rss-logo" href="https://rs.school/" target="_blank"></a>\n  </div>\n'),this.rootNode}},s=new class{constructor(){this.prefix="Christmas-",this.storage={session:sessionStorage,local:localStorage}}addItem(e,t,a){const s=this.storage[a];this.isStorageAvailable(s)?s.setItem(`${this.prefix}${e}`,JSON.stringify(t)):console.log(`some error occured during saving data to ${s}`)}deleteItem(e,t){const a=this.storage[t];this.isStorageAvailable(a)?a.removeItem(`${this.prefix}${e}`):console.log(`some error occured during deleting data to ${a}`)}getItem(e,t){const a=this.storage[t];if(this.isStorageAvailable(a))return JSON.parse(a.getItem(`${this.prefix}${e}`));console.log(`cannot get data from ${a}`)}isStorageAvailable(e){const t=e;try{const e=`${this.prefix}test-storage`;return t.setItem(e,e),t.removeItem(e),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}};var i=a(183);const n=new class{constructor(){this.rootNode=document.getElementById("app"),this.snowBtn=document.querySelector(".theme"),this.musicBtn=document.querySelector(".volume"),this.isSnowing=!1,this.isPlay=!1,this.intervalId=null,this.audio=new Audio,this.audio.src="./assets/audio/audio.mp3",this.audio.volume=.3}init(){this.initMusic(),this.initSnowing()}initMusic(){this.isPlay=s.getItem("music","local"),this.musicBtn=document.querySelector(".volume"),this.playMusicOnLoad(),this.musicBtn&&this.handleMusicBtnClick()}handleMusicBtnClick(){this.musicBtn.onclick=()=>this.playAudio()}initSnowing(){this.isSnowing=s.getItem("snow","local"),this.snowBtn=document.querySelector(".theme"),this.isSnowOnLoad(),this.snowBtn&&this.handleSnowBtnClick()}handleSnowBtnClick(){this.snowBtn.onclick=()=>this.runAndStopSnow()}isSnowOnLoad(){this.isSnowing&&(this.intervalId=setInterval(this.createSnowFlake,100),this.snowBtn&&this.snowBtn.classList.add("active"))}playMusicOnLoad(){this.isPlay&&(this.audio.play(),this.musicBtn&&(this.musicBtn.classList.remove("volume"),this.musicBtn.classList.add("mute")))}playAudio(){this.isPlay?(this.audio.pause(),this.isPlay=!1):(this.audio.play(),this.isPlay=!0),this.musicBtn.classList.toggle("volume"),this.musicBtn.classList.toggle("mute"),s.addItem("music",this.isPlay,"local")}runAndStopSnow(){this.isSnowing?(clearInterval(this.intervalId),this.snowBtn.classList.remove("active"),this.isSnowing=!1):(this.intervalId=setInterval(this.createSnowFlake,500),this.snowBtn.classList.add("active"),this.isSnowing=!0),s.addItem("snow",this.isSnowing,"local")}createSnowFlake(){this.rootNode=document.getElementById("app");const e=document.createElement("span");e.classList.add("snowflake_falling"),e.style.backgroundImage=`url("${i}")`,e.style.left=Math.random()*window.innerWidth+"px",e.style.animationDuration=5*Math.random()+3+"s",e.style.width=10*Math.random()+20+"px",e.style.height=e.style.width,e.style.opacity=`${Math.random()}`,this.rootNode.appendChild(e),setTimeout((()=>{e.remove()}),3e3)}},r=new class{init(){const e=document.querySelectorAll("[data-type=button]");e&&e.forEach((e=>{e.addEventListener("click",this.createRipple)}))}createRipple(e){const t=e.target,a=document.createElement("span"),s=Math.max(t.clientWidth,t.clientHeight),i=s/2;a.style.width=a.style.height=`${s}px`,a.style.left=e.clientX-(t.offsetLeft+i)+"px",a.style.top=e.clientY-(t.offsetTop+i)+"px",a.classList.add("ripple");const n=t.getElementsByClassName("ripple")[0];n&&n.remove(),t.append(a)}};class o{constructor(){this.view=new class{constructor(){this.rootNode=document.getElementById("app")}render(){this.rootNode.textContent="",this.createHeader(),this.createMainSection(),this.createFooter()}createHeader(){this.rootNode.append(e.getTemplate(!1))}createMainSection(){const e=document.createElement("main");e.className="content",e.insertAdjacentHTML("afterbegin",this.template()),this.rootNode.append(e)}template(){return'\n    <div class="bg__ball bg_ball1"></div>\n    <div class="bg__ball bg_ball2"></div>\n    <h1 class="home-page_title">Новогодняя игра <span>"Наряди ёлку"</span></h1>\n    <a href="#/toys" class="home-page_switch" data-type="button">Начать</a>  \n    '}createFooter(){this.rootNode.append(t.getTemplate())}}}createPage(){this.view.render(),n.init(),r.init()}}var l,c,d,h,u,p,m,g,v,f,_;!function(e){e.white="#fff",e.main="#278D9F"}(l||(l={})),function(e){e[e.percent=100]="percent",e[e.favoriteToysMaxNumber=20]="favoriteToysMaxNumber"}(c||(c={})),function(e){e.noMatch="Извините, совпадений не обнаружено"}(d||(d={})),function(e){e.ASC="asc",e.DSC="dsc"}(h||(h={})),function(e){e.color="color",e.shape="shape"}(u||(u={})),function(e){e.home="home-route",e.toys="toys-route",e.tree="tree-route"}(p||(p={})),function(e){e.home="/",e.toys="/toys",e.tree="/tree"}(m||(m={})),function(e){e.light_yellow="rgba(255, 255, 0, 1)",e.dark_yellow="rgba(255, 255, 0, 0.2)",e.light_green="rgba(0, 247, 165, 1)",e.dark_green="rgba(0, 247, 165, 0.2)",e.light_blue="rgba(0, 255, 255, 1)",e.dark_blue="rgba(0, 255, 255, 0.4)",e.light_red="rgba(247, 0, 118, 1)",e.dark_red="rgba(247, 0, 118, 0.4)"}(g||(g={})),function(e){e[e.minDistance=1]="minDistance"}(v||(v={})),function(e){e.title="Сортировать",e.nameAsc="По названию от «А» до «Я»",e.nameDsc="По названию от «Я» до «А»",e.yearAsc="По году приобретения по возрастанию",e.yearDsc="По году приобретения по убыванию"}(f||(f={})),function(e){e.nameAsc="name-asc",e.nameDsc="name-dsc",e.yearAsc="year-asc",e.yearDsc="year-dsc"}(_||(_={}));const y=new class{constructor(){this.sortWrapper=document.createElement("select"),this.filtersWrapper=document.createElement("div"),this.filtersWrapper.className="filters"}getSortingTemplate(e,t,a,s,i){return this.sortWrapper.className=e,this.sortWrapper.textContent="",t.forEach(((e,t)=>{this.sortWrapper.insertAdjacentHTML("afterbegin",`\n  <option value='${a[t]}'>${e}</option>\n  `),a[t]===s&&(this.sortWrapper.value=s)})),this.sortWrapper.onchange=e=>i(e),this.sortWrapper}getFiltersTemplate(e,t,a,s){return this.filtersWrapper.textContent="",this.filtersWrapper.insertAdjacentHTML("afterbegin",'\n        <div class="settings settings_narrow">\n            <p class="settings__title">Категории</p>\n            <div class="filter">\n              Только любимые:\n              <div>\n                <input class="filter__input filter_favorite" type="checkbox" id="favorities" data-name="favorite">\n                <label class="filter__label" for="favorities"></label>\n              </div>\n            </div>\n          </div>\n          \n          <div class="settings settings_wide">\n            <p class="settings__title">Размер</p>\n            <div class="filter">\n              Большая:\n              <div>\n                <input class="filter__input filter_size" type="checkbox" data-filter="большой" id="big" data-name="size">\n                <label class="filter__label" for="big"></label>\n              </div>\n            </div>\n            <div class="filter">\n              Средняя:\n              <input class="filter__input filter_size" type="checkbox" data-filter="средний" id="medium" data-name="size">\n              <label class="filter__label" for="medium"></label>\n            </div>\n            <div class="filter">\n              Маленькая:\n              <input class="filter__input filter_size" type="checkbox" data-filter="малый" id="small" data-name="size">\n              <label class="filter__label" for="small"></label>\n            </div>\n          </div>\n          \n          <div class="settings settings_narrow color">\n            <p class="settings__title">Цвет</p>\n            <button class="filter_color" data-filter="белый" data-name="color"></button>\n            <button class="filter_color" data-filter="желтый" data-name="color"></button>\n            <button class="filter_color" data-filter="красный" data-name="color"></button>\n            <button class="filter_color" data-filter="синий" data-name="color"></button>\n            <button class="filter_color" data-filter="зелёный" data-name="color"></button>\n          </div>\n\n          <div class="settings settings_narrow">\n            <p class="settings__title">Форма</p>\n            <span class="icon_small bell filter_shape" data-filter="колокольчик"  data-name="shape"></span>\n            <span class="icon_small ball filter_shape" data-filter="шар" data-name="shape"></span>\n            <span class="icon_small cone filter_shape" data-filter="шишка" data-name="shape"></span>\n            <span class="icon_small snowflake filter_shape" data-filter="снежинка" data-name="shape"></span>\n            <span class="icon_small toy filter_shape" data-filter="фигурка" data-name="shape"></span>\n          </div>\n        </div>\n        \n        <div class="filters">\n          <div class="range">\n            <p class="settings__title">Количество экземпляров</p>\n            <div class="range__container">\n              <span class="number" id="range1">0</span>\n              <div class="range__container_inner">\n                <div class="range__track"></div>\n                <input class="range__input" type="range" step="1" value="0" min="0" max="12" data-name="count" data-value="range1" data-filter="count-from" id="rangeTrack1">\n                <input class="range__input" type="range" step="1" value="12" min="0" max="12" data-name="count" data-value="range2" data-filter="count-to" id="rangeTrack1">\n              </div>\n              <span class="number" id="range2">12</span>\n            </div>\n          </div>\n          \n          <div class="range">\n            <p class="settings__title">Год приобретения</p>\n            <div class="range__container">\n              <span class="number" id="range3">1940</span>\n              <div class="range__container_inner">\n                <div class="range__track"></div>\n                <input class="range__input" type="range" step="1" min="1940" max="2021" value="1940" data-name="year" data-value="range3" data-filter="year-from" id="rangeTrack2">\n                <input class="range__input" type="range" step="1" min="1940" max="2021" value="2021" data-name="year" data-value="range4" data-filter="year-to" id="rangeTrack2">\n              </div>\n              <span class="number" id="range4">2021</span>\n            </div>\n        </div>\n  '),this.activateButtons(e),this.activateSliders(e),this.filtersWrapper.onclick=e=>t(e),this.filtersWrapper.oninput=e=>a(e),this.filtersWrapper.onchange=()=>s(),this.filtersWrapper}activateButtons(e){Object.keys(e).forEach((t=>{this.filtersWrapper.querySelectorAll(`.filter_${t}`).forEach((a=>{switch(t){case"favorite":e.favorite&&(a.checked=!0);break;case"size":e[t].includes(a.dataset.filter)&&(a.checked=!0);break;case"color":case"shape":e[t].includes(a.dataset.filter)&&a.classList.add("active")}}))}))}activateSliders(e){Object.keys(e).forEach((t=>{const a=this.filtersWrapper.querySelectorAll(`[data-name=${t}]`);switch(t){case"count":case"year":e[t]&&(a[0].value=e[t].from.toString(),a[1].value=e[t].to.toString(),E.colorSliders(a[0],a[1]),E.updateSliderTextValues(this.filtersWrapper,a[0]),E.updateSliderTextValues(this.filtersWrapper,a[1]))}}))}},C=new class{constructor(){this.rootNode=document.createElement("div"),this.rootNode.className="button__container"}getTemplate(e,t,a){return this.rootNode.textContent="",e.forEach(((e,a)=>{this.rootNode.insertAdjacentHTML("afterbegin",function(e,t){return`\n    <button class="button button_small" data-name="${t}" data-type="button">${e}</button>\n  `}(e,t[a]))})),this.rootNode.onclick=e=>a(e),this.rootNode}};class b{constructor({num:e,name:t,count:a,year:s,shape:i,color:n,size:r,favorite:o,selected:l=!1}){this.num=e,this.name=t,this.count=a,this.year=s,this.shape=i,this.color=n,this.size=r,this.favorite=o,this.selected=l}generateCard(e){let t="";const a=document.createElement("div");a.className="card",a.id=this.num.toString(),a.style.animationDelay=.1*e+"s",this.selected&&(a.className="card active");const s=this.favorite?"да":"нет";return t+=`<h2 class="card__title">${this.name}</h2>\n           <img class="card__image" src="./assets/img/${this.num}.png" alt="${this.name}">\n           <div class="card__description">\n            <p>Количество: <span>${this.count}</span></p>\n            <p>Год покупки: <span>${this.year}</span> год</p>\n            <p>Форма игрушки: <span>${this.shape}</span></p>\n            <p>Цвет игрушки: <span>${this.color}</span></p>\n            <p>Размер игрушки: <span>${this.size}</span></p>\n            <p>Любимая: <span>${s}</span></p>\n           </div>\n           <div class="ribbon"></div>\n          `,a.innerHTML=t,a}selectCard(){this.selected=!0}}const w=new class{constructor(){this.rootNode=document.getElementById("app"),this.selectedCards=s.getItem("selectedCards","local")||[]}render(e,t,a,s,i,n,r,o,l){this.rootNode.textContent="",this.createHeader(o,l),this.createMainSection(e,t,a,s,i,n,r),this.createFooter()}createHeader(t,a){this.selectedCards=s.getItem("selectedCards","local")||[],this.rootNode.append(e.getTemplate(!0,!0,t,a,this.selectedCards.length)),this.rootNode.querySelector(".toys-route").classList.add("link_active")}createMainSection(e,t,a,s,i,n,r){const o=document.createElement("main");o.className="content content__toys";const l=document.createElement("div");l.className="wrapper toys__wrapper",this.createFiltersBlock(l,e,t,a,s,i,n,r),this.createCardsBlock(l),o.append(l),this.rootNode.append(o)}createFiltersBlock(e,t,a,s,i,n,r,o){const l=document.createElement("div");this.createSortFilters(l,t,s),this.createFilters(l,a,i,n,r),this.addButtons(l,o),e.append(l)}createSortFilters(e,t,a){const s=document.createElement("div");s.className="settings settings_wide";const i=document.createElement("span");i.className="settings__title",i.textContent=f.title;const n=[_.nameAsc,_.nameDsc,_.yearAsc,_.yearDsc],r=[f.nameAsc,f.nameDsc,f.yearAsc,f.yearDsc],o=this.setSortingChosen(t);s.append(y.getSortingTemplate("select button",r,n,o,a)),e.append(s)}setSortingChosen(e){return`${e.key}-${e.direction.slice(0,3).toLowerCase()}`}createFilters(e,t,a,s,i){e.append(y.getFiltersTemplate(t,a,s,i))}addButtons(e,t){e.append(C.getTemplate(["Сброс настроек","Сбросить фильтры"],["resetLS","reset"],t))}createCardsBlock(e){const t=document.createElement("div");t.className="cards-container cards-layout";const a=document.createElement("div");a.className="cards-inner-container",t.append(a),e.append(t)}renderCards(e,t){const a=this.rootNode.querySelector(".cards-inner-container");if(a.textContent="",0===e.length){const e=document.createElement("div");e.innerHTML=d.noMatch,e.className="no-cards",a.append(e)}e.forEach(((e,s)=>{const i=new b(e),n=i.generateCard(s);this.checkIfCardIsSelected(i)&&n.classList.add("active"),n.onclick=e=>t(e),a.append(n)}))}checkIfCardIsSelected(e){let t=!1;return this.selectedCards.includes(e.num)&&(t=!0),t}createFooter(){this.rootNode.append(t.getTemplate())}};var S=a(769),I=function(e,t,a,s){return new(a||(a=Promise))((function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))};const k=new class{build(){return I(this,void 0,void 0,(function*(){return yield this.load(S)}))}load(e){return I(this,void 0,void 0,(function*(){const t=yield fetch(e);return(yield t.json()).map((e=>({num:Number(e.num),name:e.name,count:Number(e.count),year:Number(e.year),shape:e.shape,color:e.color,size:e.size,favorite:e.favorite})))}))}},N=new class{constructor(){this.cardsToRender=[]}filterData(e){this.cardsToRender=[];const t=s.getItem("filters","local")||{};e.map((e=>{let a=!0;(t.name&&!e.name.toLowerCase().includes(t.name)||Object.prototype.hasOwnProperty.call(t,"favorite")&&t.favorite!==e.favorite||t.size&&!t.size.some((t=>t===e.size))||t.color&&!t.color.some((t=>t===e.color))||t.shape&&!t.shape.some((t=>t===e.shape))||t.count&&(t.count.from>e.count||t.count.to<e.count)||t.year&&(t.year.from>e.year||t.year.to<e.year))&&(a=!1),a&&this.cardsToRender.push(e),E.renderCards(this.cardsToRender)}))}};var x=a(195),T=a(377);const E=new class{constructor(){this.model=new class{constructor(){this.allCards=[],this.selectedCards=[],this.sortConditions={key:"name",direction:h.ASC},this.filters={}}getData(){return e=this,t=void 0,s=function*(){return this.allCards=yield k.build(),this.selectedCards=this.getSelectedCards(),this.allCards.forEach((e=>{this.selectedCards.includes(e.num)&&(e.selected=!0)})),this.sortData(),this.getFilters(),this.allCards},new((a=void 0)||(a=Promise))((function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}));var e,t,a,s}get cards(){return this.allCards}updateSelectedCards(e,t){this.selectedCards=this.getSelectedCards();const a=this.allCards.find((t=>t.num===parseInt(e))),i=document.querySelector(".favorite"),n=document.querySelector(".favorite-number");if(this.selectedCards.length<c.favoriteToysMaxNumber&&!a.selected)a.selected=!0,this.selectedCards.push(a.num),t.classList.add("active");else if(a.selected){a.selected=!1;const e=this.selectedCards.indexOf(a.num);this.selectedCards.splice(e,1),t.classList.remove("active")}else{const e=document.createElement("p");e.className="favorite-number_limit",e.innerHTML="Извините, все слоты заполнены",i.append(e),setTimeout((()=>{e.remove()}),5e3)}n.innerHTML=`${this.selectedCards.length}`,s.addItem("selectedCards",this.selectedCards,"local")}getSelectedCards(){return this.selectedCards=s.getItem("selectedCards","local")||[],this.selectedCards}sortData(){this.sortConditions=this.getSortingFilters(),this.sortConditions.direction===h.ASC?this.allCards.sort(((e,t)=>e[this.sortConditions.key]>t[this.sortConditions.key]?1:-1)):this.allCards.sort(((e,t)=>e[this.sortConditions.key]>t[this.sortConditions.key]?-1:1))}saveSortingFilters(e){this.sortConditions.key=e.split("-")[0],"DSC"===e.split("-")[1].toUpperCase()?this.sortConditions.direction=h.DSC:this.sortConditions.direction=h.ASC,s.addItem("sortConditions",this.sortConditions,"local")}getSortingFilters(){return this.sortConditions={key:"name",direction:h.ASC},s.getItem("sortConditions","local")&&(this.sortConditions=s.getItem("sortConditions","local")),this.sortConditions}updateFilters(...e){const t=[...e][0];t.favorite&&(this.filters.favorite=!0),!1===t.favorite&&delete this.filters.favorite,t.size&&(t.size.length>0?this.filters.size=t.size:delete this.filters.size),t.color&&(t.color.length>0?this.filters.color=t.color:delete this.filters.color),t.shape&&(t.shape.length>0?this.filters.shape=t.shape:delete this.filters.shape),t.count&&(this.filters.count=t.count),t.year&&(this.filters.year=t.year),(t.name||""===t.name)&&(t.name?this.filters.name=t.name:delete this.filters.name),this.saveFilters()}filterData(){N.filterData(this.allCards)}saveFilters(){s.addItem("filters",this.filters,"local")}getFilters(){this.filters=s.getItem("filters","local")||{}}},this.view=w}createPage(){return e=this,t=void 0,s=function*(){const e=yield this.model.getData(),t=this.model.sortConditions,a=this.model.filters;this.view.render(t,a,this.sortCards.bind(this),this.filterCards.bind(this),this.handleRangeFiltering.bind(this),this.handleCardsRerendering.bind(this),this.handleButtonClick.bind(this),this.handleSearchFieldChange.bind(this),this.handleSearchFieldClearance.bind(this)),N.filterData(e),n.init(),r.init()},new((a=void 0)||(a=Promise))((function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}));var e,t,a,s}renderCards(e){this.view.renderCards(e,this.selectCard.bind(this))}selectCard(e){const t=e.currentTarget;this.model.updateSelectedCards(t.id,t)}sortCards(e){const t=e.target.value;this.model.saveSortingFilters(t),this.model.sortData(),this.view.renderCards(this.model.cards,this.selectCard.bind(this))}filterCards(e){const t=e.target;if("LABEL"===t.tagName)return;const a=t.dataset.name;if("favorite"===a)return this.model.updateFilters({[a]:t.checked}),void this.model.filterData();if("size"===a){const e=document.querySelectorAll(".filter_size"),t=[];return e.forEach((e=>{e.checked&&t.push(e.dataset.filter)})),this.model.updateFilters({[a]:t}),void this.model.filterData()}if("color"===a||"shape"===a){t.classList.toggle("active");const e=document.querySelectorAll(`.filter_${a}`),s=[];return e.forEach((e=>{e.className.includes("active")&&s.push(e.dataset.filter)})),this.model.updateFilters({[a]:s}),void this.model.filterData()}}handleRangeFiltering(e){const t=e.currentTarget,a=e.target,s=a.dataset.name;"count"!==s&&"year"!==s||(this.limitBindSliderValues(a,s),this.updateSliderTextValues(t,a))}handleCardsRerendering(){this.model.filterData()}limitBindSliderValues(e,t){let a;"INPUT"!==e.previousElementSibling.tagName?(a=e.nextElementSibling,e.value=+a.value-+e.value<=0?a.value:e.value,this.colorSliders(e,a),this.model.updateFilters({[t]:{from:Number(e.value),to:Number(a.value)}})):(a=e.previousElementSibling,e.value=+e.value-+a.value<=0?a.value:e.value,this.colorSliders(a,e),this.model.updateFilters({[t]:{from:Number(a.value),to:Number(e.value)}}))}updateSliderTextValues(e,t){const a=t.dataset.value;e.querySelector(`#${a}`).textContent=t.value}colorSliders(e,t){const a=parseInt(e.value),s=parseInt(t.value),i=parseInt(e.min),n=parseInt(e.max),r=(a-i)/(n-i)*c.percent,o=(s-i)/(n-i)*c.percent;e.style.background=`linear-gradient(to right, ${l.white} ${r}% , ${l.main} ${r}% , ${l.main} ${o}%, ${l.white} ${o}%)`}handleButtonClick(e){const t=e.target.dataset.name,a=this.model.filters;"resetLS"===t?(localStorage.clear(),Object.keys(a).length>0&&this.createPage()):Object.keys(a).length>0&&(s.deleteItem("filters","local"),this.createPage())}handleSearchFieldChange(e){const t=e.target,a=t.dataset.name,s=document.querySelector("[data-value='search']"),i=document.querySelector("[data-value='delete']");t.value&&s?(s.style.backgroundImage=`url(${T})`,s.dataset.value="delete"):t.value||(i.style.backgroundImage=`url(${x})`,i.dataset.value="search"),this.model.updateFilters({[a]:t.value}),this.model.filterData()}handleSearchFieldClearance(e){const t=e.target;if("delete"===t.dataset.value){const e=t.previousElementSibling,a=e.dataset.name;e.value="",t.style.backgroundImage=`url(${x})`,t.dataset.value="search",this.model.updateFilters({[a]:e.value}),this.model.filterData()}}};const $=new class{constructor(){this.allCards=[]}getData(){return e=this,t=void 0,s=function*(){return this.allCards=yield k.build(),this.allCards},new((a=void 0)||(a=Promise))((function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}));var e,t,a,s}saveVariant(e,t){s.addItem(`${e}`,t,"local")}getVariant(e){return s.getItem(e,"local")}clearLS(){s.deleteItem("tree","local"),s.deleteItem("bg","local"),s.deleteItem("lights","local"),s.deleteItem("lightsColor","local")}};const L=new class{dragStartHandler(e){e.dataTransfer.setData("id",e.target.id)}dragOverHandler(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}dropHandler(e){return t=this,a=void 0,i=function*(){e.preventDefault();const t=e.dataTransfer.getData("id"),a=document.getElementById(t);if(a){const t=document.querySelector("area"),s=e.target,i=document.querySelectorAll(".favorites__card"),n=parseInt(a.id.split("_")[0]),r=a.parentNode.firstChild,o=r.innerHTML,l=i[n].firstChild.innerHTML,c=parseInt(a.dataset.count),d=(yield k.build())[c-1].count;if(s===t){const t=a.getBoundingClientRect().width/2,i=2*a.getBoundingClientRect().height,n=e.clientX-t,l=e.clientY-i;a.style.left=n+"px",a.style.top=l+"px",parseInt(r.innerHTML)>0&&(r.innerHTML=(parseInt(o)-1).toString()),s.append(a),this.saveToysCoords(a.id,a.style.left,a.style.top,r.innerHTML)}else a.style.left="0px",a.style.top="0px",parseInt(l)<d&&(i[n].firstChild.innerHTML=(parseInt(l)+1).toString()),i[n].append(a),this.deleteToyCoords(a.id)}},new((s=void 0)||(s=Promise))((function(e,n){function r(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(t){var a;t.done?e(t.value):(a=t.value,a instanceof s?a:new s((function(e){e(a)}))).then(r,o)}l((i=i.apply(t,a||[])).next())}));var t,a,s,i}saveToysCoords(e,t,a,i){const n=s.getItem("toysCoords","local")||{};n[e]={left:t,top:a,count:i},s.addItem("toysCoords",n,"local")}deleteToyCoords(e){const t=s.getItem("toysCoords","local")||{};console.log(t[e]),delete t[e],s.addItem("toysCoords",t,"local")}},D=new class{constructor(){this.favoriteCard=[]}getTemplate(e,t,a,s,i,n){this.favoriteCard=[];const r=document.createElement("div");r.className="settings__container",r.textContent="",r.classList.add(e);const o="tree"===t||"decorated"===t?"png":"jpg";for(let n=0;n<a;n++){const a=document.createElement("div");a.className=`${s} setting__item`,a.dataset.name=`${e.split("_")[0]}`,a.dataset.value=`${e.split("_")[0]}${n+1}`,"favorites"!==t&&(t="decorated"===t?"tree":t,a.style.backgroundImage=`url("./assets/img/${t}${n+1}.${o}")`),"favorites"===t&&this.favoriteCard.push(a),i&&(a.onclick=e=>i(e)),r.append(a)}return n&&this.renderFavoriteToys(n),r}renderFavoriteToys(e){for(let t=0;t<e.length;t++){const a=document.createElement("p");a.className="favorites__card_count",a.innerHTML=e[t].count.toString(),this.favoriteCard[t].append(a);for(let a=1;a<=e[t].count;a++){const s=document.createElement("img");s.src=`assets/img/${e[t].num}.png`,s.className="favorites__card_img",s.setAttribute("alt","toy"),s.setAttribute("id",`${t}_${a}`),s.setAttribute("width","55"),s.setAttribute("height","55"),s.setAttribute("draggable","true"),s.style.zIndex="2",s.dataset.count=e[t].count.toString(),s.ondragstart=e=>L.dragStartHandler(e),this.favoriteCard[t].append(s)}}}getLightsVariantsTemplate(e){const t=document.createElement("div");t.className="lights_choice settings__container",t.textContent="";const a=document.createElement("div");a.className="light__variant_container";for(let t=0;t<=4;t++){const s=document.createElement("button");s.className="light__variant",s.classList.add(e[t]),s.dataset.color=e[t],s.onclick=e=>this.handleLightsChoice(e),a.append(s)}return t.append(a),this.createLightsSwitcher(t),t}createLightsSwitcher(e){const t=document.createElement("div");t.className="lights__switcher";const a=document.createElement("input");a.type="checkbox",a.setAttribute("checked","checked"),a.className="lights__switcher_input",a.setAttribute("id","lights__switcher");const s=document.createElement("label");s.className="lights__switcher_label",s.setAttribute("for","lights__switcher");const i=document.createElement("div");i.className="switcher_inner-container";const n=document.createElement("div");n.className="switcher_indicator",a.onchange=e=>this.handleLightsSwitcher(e),s.append(i),s.append(n),t.append(a),t.append(s),e.append(t),this.setSwitcher(a,s)}setSwitcher(e,t){const a=t.querySelector(".switcher_indicator"),i=t.querySelector(".switcher_inner-container"),n=s.getItem("lights","local");e.checked=!!n,e.checked?(a.style.right="0",i.style.margin="0"):(a.style.right="55px",i.style.marginLeft="-100%")}handleLightsSwitcher(e){const t=e.target,a=t.nextElementSibling;s.addItem("lights",t.checked,"local"),this.setSwitcher(t,a),B.createPage()}handleLightsChoice(e){const t=e.target,a=t.dataset.color,i=t.parentNode.nextElementSibling.querySelector("input"),n=i.nextElementSibling;i.checked=!0,s.addItem("lights",i.checked,"local"),this.saveColor(a),this.setSwitcher(i,n),B.createPage()}saveColor(e){switch(e){case"light_red":s.addItem("lightsColor",g.light_red,"local");break;case"light_blue":s.addItem("lightsColor",g.light_blue,"local");break;case"light_yellow":s.addItem("lightsColor",g.light_yellow,"local");break;case"light_green":s.addItem("lightsColor",g.light_green,"local");break;case"light_multicolor":s.addItem("lightsColor","multicolor","local")}}},A=new class{constructor(){this.rootNode=document.getElementById("app"),this.lightsContainer=document.createElement("div"),this.allCards=[],this.selectedCards=s.getItem("selectedCards","local")||[],this.lightsColor=s.getItem("lightsColor","local")||g.light_yellow,this.lightVariants=["light_multicolor","light_red","light_blue","light_yellow","light_green"],this.intervalID1=null,this.intervalID2=null,this.intervalID3=null,this.intervalID4=null,this.intervalID5=null,this.intervalID6=null,this.intervalID7=null}render(e,t,a,i,n){this.rootNode.textContent="",this.clearIntervals(),this.allCards=a,this.createHeader(),this.createMainSection(e,t,i,n);const r=s.getItem("lights","local");s.getItem("lightsColor","local")&&(this.lightsColor=s.getItem("lightsColor","local")),r&&this.renderLights(this.lightsContainer,this.lightsColor),this.checkToysCoords(),this.createFooter()}createMulticolor(){const e=[g.dark_blue,g.light_blue,g.dark_green,g.light_green,g.dark_red,g.light_red,g.dark_yellow,g.light_yellow];return e[class{static getRandomNum(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}.getRandomNum(0,e.length)]}createHeader(){this.selectedCards=s.getItem("selectedCards","local")||[],this.rootNode.append(e.getTemplate(!0,!1,void 0,void 0,this.selectedCards.length)),this.rootNode.querySelector(".tree-route").classList.add("link_active")}createMainSection(e,t,a,s){const i=document.createElement("main");i.className="content content__tree";const n=document.createElement("div");n.className="wrapper tree__wrapper",this.createSettingsBlock(n,a,s),this.createMainTreeBlock(n,e,t),this.createFavoritiesBlock(n,a),i.append(n),this.rootNode.append(i)}createSettingsBlock(e,t,a){const s=document.createElement("div");s.className="tree__settings",s.append(D.getTemplate("tree_choice","tree",6,"tree__variant",t)),s.append(D.getTemplate("bg_choice","bg",10,"bg__variant",t)),s.append(D.getLightsVariantsTemplate(this.lightVariants)),s.append(C.getTemplate(["Сбросить настройки"],[""],a)),e.append(s)}createMainTreeBlock(e,t,a){const s=document.createElement("div");s.className="tree__main-tree",s.style.background=`url("./assets/img/${a}.jpg") center / cover no-repeat`;const i=document.createElement("img");i.className="main-tree",i.src=`./assets/img/${t}.png`,i.setAttribute("usemap","#tree-map");const n=document.createElement("map");n.setAttribute("name","tree-map");const r=document.createElement("area");r.setAttribute("shape","poly"),r.setAttribute("coords","247,61,48,615,247,668,333,674,406,649,444,605"),n.append(r),s.append(i),s.append(n),this.createLightRope(s),r.ondragover=e=>L.dragOverHandler(e),r.ondrop=e=>L.dropHandler(e),document.ondragover=e=>L.dragOverHandler(e),document.ondrop=e=>L.dropHandler(e),e.append(s)}createLightRope(e){this.lightsContainer.textContent="",this.lightsContainer.className="lights__onTree-container",e.append(this.lightsContainer)}renderLights(e,t){const a=document.createElement("canvas");a.setAttribute("id","canvas"),a.width=e.offsetWidth,a.height=e.offsetHeight,window.addEventListener("resize",(()=>{a.width=e.offsetWidth,a.height=e.offsetHeight}));const s=a.getContext("2d");this.intervalID1=setInterval((()=>{s.clearRect(0,0,a.width,a.height)}),1500),this.intervalID2=this.setInterval(a,s,-2,3,170,t,300),this.intervalID3=this.setInterval(a,s,-3,5,250,t,500),this.intervalID4=this.setInterval(a,s,-5,7,350,t,400),this.intervalID5=this.setInterval(a,s,-6,9,450,t,200),this.intervalID6=this.setInterval(a,s,-8,10,550,t,300),this.intervalID7=this.setInterval(a,s,-10,13,650,t,400),e.append(a)}setInterval(e,t,a,s,i,n,r){return setInterval((()=>{for(let r=a;r<s;r+=3)t.beginPath(),t.arc(e.width/2+15*r,i-Math.pow(r,2),5,0,2*Math.PI),t.stroke(),this.setContext(t,n)}),r)}setContext(e,t){let a=t;"multicolor"===t&&(a=this.createMulticolor()),e.fillStyle=a,e.strokeStyle=a,e.shadowColor=a,e.shadowBlur=10,e.shadowOffsetX=5,e.shadowOffsetY=5,e.fill()}clearIntervals(){clearInterval(this.intervalID1),clearInterval(this.intervalID2),clearInterval(this.intervalID3),clearInterval(this.intervalID4),clearInterval(this.intervalID5),clearInterval(this.intervalID6),clearInterval(this.intervalID7)}createFavoritiesBlock(e,t){const a=document.createElement("div"),s=this.formFavoriteCardsArr();a.className="tree__favorites",a.append(D.getTemplate("favorites_container","favorites",20,"favorites__card",void 0,s)),a.append(D.getTemplate("decorated_container","decorated",6,"decorated_container_inner",t)),e.append(a)}formFavoriteCardsArr(){this.selectedCards=s.getItem("selectedCards","local")||[];const e=[];let t=[];return this.selectedCards.length>0?this.selectedCards.forEach((t=>{e.push(this.allCards.filter((e=>e.num===t)))})):e.push(this.allCards.filter((e=>e.num<=20))),t=e.reduce(((e,t)=>[...e,...t])),t}checkToysCoords(){const e=s.getItem("toysCoords","local")||{},t=this.rootNode.querySelector("area");Object.keys(e).forEach((a=>{const s=document.getElementById(`${a}`),i=s.parentNode.firstChild;s.style.left=e[a].left,s.style.top=e[a].top,i.innerHTML=e[a].count,t.append(s)}))}createFooter(){this.rootNode.append(t.getTemplate())}};const B=new class{constructor(){this.model=$,this.view=A,this.treeVariant="tree1",this.bgVariant="bg1"}createPage(){return e=this,t=void 0,s=function*(){const e=yield this.model.getData();this.treeVariant=this.model.getVariant("tree")?this.model.getVariant("tree"):"tree1",this.bgVariant=this.model.getVariant("bg")?this.model.getVariant("bg"):"bg1",this.view.render(this.treeVariant,this.bgVariant,e,this.handleVariantChoice.bind(this),this.handleButtonClick.bind(this)),n.init(),r.init()},new((a=void 0)||(a=Promise))((function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}));var e,t,a,s}handleVariantChoice(e){const t=e.target,a=t.dataset.name,s=t.dataset.value;"tree"===a&&(this.treeVariant=s),"bg"===a&&(this.bgVariant=s),this.model.saveVariant(a,s),this.createPage()}handleButtonClick(){this.model.clearLS(),this.createPage()}},M=new class{constructor(){this.homePageController=new o,this.toysPageController=E,this.treePageController=B}getRoutes(){return[{path:/ /,callback:()=>this.homePageController.createPage()},{path:/toys/,callback:()=>this.toysPageController.createPage()},{path:/tree/,callback:()=>this.treePageController.createPage()}]}},F=new class{constructor(e){this.routes=[],e.routes&&(this.routes=e.routes),this.root="/",e.root&&(this.root=e.root),this.current=null,this.intervalId=null,this.listen()}addPath(e,t){this.routes.push({path:e,callback:t})}setRoot(e){this.root=e}addAllPath(e){this.routes=e}removePath(e){const t=this.routes.find((t=>t.path===e));t&&this.routes.splice(this.routes.indexOf(t),1)}getPath(e){return e.toString().replace(/^\//,"").replace(/\\/,"").replace(/\/$/,"")||this.root}getRoute(){let e="";const t=window.location.href.match(/#(.*)$/);return e=t&&t[1]?t[1]:this.root,this.getPath(e)}navigate(e=""){window.location.href=`${window.location.href.replace(/#(.*)$/,"")}#/${this.getPath(e)}`}listen(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(this.checkRoute.bind(this),50)}checkRoute(){this.current!==this.getRoute()&&(this.current=this.getRoute(),this.routes.some((e=>{if(this.current){const t=this.current.match(e.path);if(t){const a=t.shift();return this.navigate(a),e.callback.apply({},t),this}return this.navigate(this.root),!1}this.navigate(this.root)})))}}({root:" "}),P=M.getRoutes();F.addAllPath(P)})()})();